!function(){Blaze.Mixer.add("animator",{mixinBeforeInitialize:function(){this._animating=!1,_.bindAll(this,"_animate")},startAnimation:function(){this._animating||(this._animating=!0,this._animate())},_animate:function(a){return this.onAnimationFrame(a)===!1?(console.log("returned false"),void this.stopAnimation()):void(this.af=requestAnimationFrame(this._animate))},stopAnimation:function(){this.af&&cancelAnimationFrame(this.af),this.af=null,this._animating=!1},mixinBeforeRemove:function(){this.stopAnimation()},isAninmating:function(){return this._animating},onAnimationFrame:function(){}}),Blaze.Mixer.add("assetLoader",{assets:{},mixinAfterInitialize:function(a){return a.assets&&(this.assets=a.assets),a},loadAssets:function(){var a=[];return _.each(this.assets.configs,function(b){a.push(Blaze.Configs.load(b))}),_.each(this.assets.labels,function(b){a.push(Blaze.Labels.load(b))}),_.each(this.assets.templates,function(b){a.push(Blaze.Templates.load(b))}),_.each(this.assets.resources,function(b){a.push(Blaze.Resources.load(b))}),Q.all(a).fail(this.onAssetLoadError)},onAssetLoadError:function(a){console.error(a,a.stack)}}),Blaze.Mixer.add("canvas",{mixinBeforeInitialize:function(a){a=a||{},this._makeCanvas(),this.ctx=this.el.getContext("2d"),this.setCanvasWidth(this.w||a.w||100),this.setCanvasHeight(this.h||a.h||100)},_makeCanvas:function(){var a=_.extend({},_.result(this,"attributes"));this.id&&(a.id=_.result(this,"id")),this.className&&(a["class"]=_.result(this,"className"));var b=Backbone.$("<canvas>").attr(a);this.setElement(b,!1)},setCanvasWidth:function(a){this.w=a,this.el.width=a},setCanvasHeight:function(a){this.h=a,this.el.height=a},render:function(){}}),Blaze.Mixer.add("collectionEvents",{mixinAfterInitialize:function(a){var b=a&&a.collectionEvents?a.collectionEvents:this.collectionEvents;b&&this.delegateCollection(b)},delegateCollection:function(a){_.isFunction(a)&&(a=a()),_.isObject(a)&&this.hashbind(this.collection,a)},undelegateCollection:function(){this.stopListening(this.collection)}}),Blaze.Mixer.add("commandClick",{mixinAfterInitialize:function(a){this.cmd=a.command||(this.model?this.model.get("command"):null)||this.id,this.cmd||console.error("commandClick no commandid given")},events:{click:"runCommand"},runCommand:function(a){Blaze.Commands.run(this.cmd),a.preventDefault()}}),Blaze.Mixer.add("commandable",{commands:{},mixinAfterInitialize:function(){var a;this.config&&this.config.commands&&(a=_.isString(this.config.commands)?JSON.parse(this.config.commands):this.config.commands,this.commands=_.extend(this.commands,a));var b={};_.each(this.commands,function(a,c){b[c]=function(){Blaze.Commands.run(a)}}),this.events=_.extend(this.events,b),this.delegateEvents()}}),Blaze.Mixer.add("completionTracker",{_compReqs:{},args:{completed:"bCompleted",activityType:"sActivityType",tracked:"bTrack"},onModelParsed:function(a){_.each(a.nodes,this.mapReqNode,this),this.delegateGlobal({"node:start node:after:remove":"checkNodeCompletion"}),Blaze.dispatcher.trigger("completion:ready",a)},mapReqNode:function(a){a.set(this.args.bCompleted,0),a.set("_reqs",this.getReqList(a))},getReqList:function(a){return _.reduce(this._compReqs,function(b,c){return c.matcher(a)&&b.push(c.name),b},[])},checkNodeCompletion:function(a){if(!a.get(this.args.completed)){var b=_.every(a.get("_reqs"),function(b){return this.checkRequiment(b,a)},this);b&&(a.set(this.args.completed,1),Blaze.dispatcher.trigger("completion:set",a),a.parent&&(console.log("check parent",a.parent.get("nodeid")),this.checkNodeCompletion(a.parent)))}Blaze.dispatcher.trigger("completion:update")},checkRequiment:function(a,b){var c=this._compReqs[a];return c&&_.isFunction(c.complete)?c.complete(b):!1},setActivityComplete:function(a){this._setSegmentComplete(a)},addCompletionReq:function(a,b,c){return a&&_.isFunction(b)&&_.isFunction(c)?void(this._compReqs[a]={name:a,matcher:b,complete:c}):void console.warn("addCompletionRequirement requires (name[String], matcher[function] and isComplete[function]")}}),Blaze.Mixer.add("configurable",{mixinBeforeInitialize:function(a){var b;a||(a={}),this.config=_.extend({},this.defaultConfig||{}),a.model&&_.isFunction(a.model.get)&&(b=a.model.get("sProfile")),b||(b=a&&_.isString(a.configid)?a.configid:this.configid),b&&this.getBlazeConfig(b),this.model&&this.overrideConfigFromModel()},mixinAfterInitialize:function(){this.$el&&(classNames="profile-"+(_.isString(this.config.id)?this.config.id:"default"),this.config.sClassName&&(classNames+=" "+this.config.sClassName),this.$el.addClass(classNames)),this.profileReady()},setConfigs:function(a){this.config=_.extend({},this.config,a)},configis:function(a,b){return this.config[a]==b},getBlazeConfig:function(a){this.setConfigs(Blaze.Configs.get(a))},overrideConfigFromModel:function(){_each(_.keys(this.config),function(a){var b=this.model.get(a);_.isUndefined(b)&&(this.config[a]=_.processAttr(b))},this)},profileReady:function(){}}),Blaze.Mixer.add("globalEvents",{mixinAfterInitialize:function(a){var b=a&&a.globalEvents?a.globalEvents:this.globalEvents;b&&this.delegateGlobal(b)},delegateGlobal:function(a){_.isFunction(a)&&(a=a()),_.isObject(a)&&this.hashbind(Blaze.dispatcher,a)},triggerGlobal:function(){this.suppressLocalEvents||this.trigger.apply(this,arguments),Blaze.dispatcher.trigger.apply(Blaze.dispatcher,arguments)}}),Blaze.Mixer.add("hasViews",{mixinBeforeInitialize:function(){this._views={}},mixinAfterInitialize:function(){this.$el&&this.createViews()},createViews:function(){},addView:function(a,b,c,d){return this._views[a]=b,_.isObject(d)&&this.hashbind(b,d),c&&(_.isString(c)?(this.$?this.$(c):$(c)).append(b.el):_.isJquery(c)&&c.append(b.el)),b},removeView:function(a){var b=this._views[a];return b.stopListening(),b.remove(),delete this._views[a],this},hasView:function(a){return _.has(this._views,a)},getView:function(a){return this._views[a]}}),Blaze.Mixer.add("hashBinder",{hashbind:function(a,b){var c=this;return a&&_.isFunction(a.listenTo)&&_.isObject(b)&&_.each(b,function(b,d){var e=c[b];_.isFunction(e)&&c.listenTo(a,d,_.bind(e,c))}),this}}),Blaze.Mixer.add("htmlBinder",{mixinAfterRender:function(a){return this.applyBindings(),a},applyBindings:function(){var a=this.$("[data-bind]");_.each(a,function(a){var b=$(a),c=b.data("bind"),d="change:"+c;this.listenTo(this.model,d,function(a,c){b.html(c)})},this)}}),Blaze.Mixer.add("ileSerializer",{serializers:{},onModelParsed:function(a){_.each(a.nodes,this._setNodeSerializer,this)},serialize:function(){},deserialize:function(){},getLookup:function(){return _.chain(node.attributes).pick("nodeid","sProfile","sActivityType","sTemplate","nodeType").toArray().compact().value().push("all")},_setNodeSerializer:function(){var a=_.find(this.getLookup(),function(a){return a?this.serializers[a]:!1},this);node.setSerializer(this.serializers[a]||[])},addNodeSerializer:function(a,b){_.isString(a)&&_.isArray(b)&&(this.serializers[a]=b)}}),Blaze.Mixer.add("modelEvents",{mixinAfterInitialize:function(a){var b=a&&a.modelEvents?a.modelEvents:this.modelEvents;b&&this.delegateModel(b)},delegateModel:function(a){_.isFunction(a)&&(a=a()),_.isObject(a)&&this.hashbind(this.model,a)},undelegateModel:function(){this.stopListening(this.model)},mixinBeforeRemove:function(){this.undelegateModel()}}),Blaze.Mixer.add("nodeViewer",{viewMap:{},mixinBeforeInitialize:function(){this._rendering=!1,this.viewPaths||(this.viewPaths=[Blaze.dna]),this.cssViewClassCompiler||(this.cssViewClassCompiler=function(a){return _.isFunction(a.mapUp)?a.mapUp(function(a){return a.getFormatedNodeId("-")},!0).join(" "):a.getFormatedNodeId("-")}),this.viewMap||(this.viewMap=[]),this.viewArgSearch||(this.viewArgSearch=function(a){var b=a.attributes;return b.sActivityType||b.sTemplate||b.sType}),_.bindAll(this,"_renderNodeComplete","_renderNodeError","_removeViewController","_removeViewControllerComplete","_removeCurrentView"),Blaze.dispatcher.trigger("viewer:ready")},addViewPath:function(a){this.viewPaths.push(a)},addViewMapping:function(a){return _.isArray(a)?this.viewMap.concat(a):this._addViewMapping(a),this},_addViewMapping:function(a){a&&_.isString(a.id)||console.error("nodeViewer mapping must have an id"),this.viewMap[a.id]=a,Blaze.dispatcher.trigger("viewer:mapped",this.viewMap)},getViewMapping:function(a){return _.findWhere(this.viewMap,{id:a})},getViewMappingByArg:function(a){return this.getViewMapping(this.viewArgSearch(a))},hasViewMapping:function(a){return this.viewMap[a]},getViewController:function(a){var b;{if(!_.isString(a))return a;for(var c=0;c<this.viewPaths.length;c++)if(b=this.viewPaths[c][a],b&&_.isFunction(b))return b}},getViewContainer:function(a){return a?_.isString(a)?$(a):a:(this.$container||(this.$container=this.defaultContainer?_.isString(this.defaultContainer)?$(this.defaultContainer):this.defaultContainer:$("#ContentArea")),this.$container)},isEmpty:function(){return this.currentView},renderViewNode:function(a){if(a){var b,c,d,e,f=this,g=this.viewArgSearch(a),h=this.getViewMapping(g),i=(a.get("nodeid"),a.getFormatedNodeId("_")),j=this.cssViewClassCompiler(a);return h?(b=this.getViewContainer(h.el),d=this.getViewController(h.controller),c=h.template,e=h.configid):(d=this.getViewController(g)||this.defaultController,c=Blaze.Templates.hasTemplate(i)?i:this.defaultTemplate),b||(b=this.getViewContainer()),Blaze.dispatcher.trigger("node:before",a),Q.fcall(this._removeCurrentView).then(function(){return f._beforeRenderView(a)}).then(function(){return f._createNodeView(d,a,c,e,b,j)}).then(this._renderNodeComplete).fail(this._renderNodeError)}},_removeCurrentView:function(){if(this._rendering=!0,this.currentView){if(Blaze.dispatcher.trigger("node:before:remove",this.currentView.node),this.currentView.controller)return Q.fcall(this._removeViewController).then(this._removeViewControllerComplete);this._removeViewTemplate()}},_removeViewController:function(){return this.currentView.controller.remove()},_removeViewControllerComplete:function(){this.currentView.el.removeClass(this.currentView.cls),Blaze.dispatcher.trigger("node:after:remove",this.currentView.node),this.currentView=null},_removeViewTemplate:function(){this.currentView.el.empty(),this.currentView.el.removeClass(this.currentView.cls),this.currentView=null},_beforeRenderView:function(a){var b=[];return Blaze.dispatcher.trigger("node:before:render",a,b),Q.all(b)},_createNodeView:function(a,b,c,d,e,f){var g;return a?(g=new a({model:b,configid:d}),e.append(g.el)):c&&e.html(Blaze.Templates.render(c,b.toJSON())),e.addClass(f),this._setCurrentView(b,g,c,f,e),g?Q.all(g.render()||[]):void 0},_setCurrentView:function(a,b,c,d,e){this.currentView={node:a,controller:b,template:c,cls:d,el:e}},_renderNodeComplete:function(){var a=this.currentView.node;this._rendering=!1,Blaze.dispatcher.trigger("node:after:render",a),Blaze.dispatcher.trigger("node:start",a)},isRenderingNode:function(){return this._rendering},_renderNodeError:function(a){console.error(a,a.stack)}}),Blaze.Mixer.add("positionable",{position:function(a,b){return this.$el.css({top:(a||0)+"px",left:(b||0)+"px"}),this},getVector:function(){var a=this.$el.position();return[a.left,a.top]},offsetBy:function(a,b){var c=this.offsetBy();this.position(c[0]+a,c[1]+b)},right:function(a){return this.$el.css({right:(a||0)+"px"}),this},left:function(a){return this.$el.css({left:(a||0)+"px"}),this},top:function(a){return this.$el.css({top:(a||0)+"px"}),this},bottom:function(a){return this.$el.css({bottom:(a||0)+"px"}),this}}),Blaze.Mixer.add("shortcuts",{mixinAfterInitialize:function(){this._kid=_.uniqueId("kid"),this.shortcuts&&this.delegateShortcuts(n)},addShortcut:function(a,b){_.isString(a)&&_.isFunction(b)&&(this._hasShortcuts=!0,Blaze.utils.keybind(this._kid,a,_.bind(b,this)))},delegateShortcuts:function(a){var b=this;_.isObject(a)&&_.each(a,function(a,c){b.addShortcut(c,b[a])})},mixinBeforeRemove:function(){this.removeShortcuts()},removeShortcuts:function(){Blaze.utils.keyunbind(this._kid),this._hasShortcuts=!1},hasShortcuts:function(){return this._hasShortcuts}}),Blaze.Mixer.add("statefull",{mixinAfterInitialize:function(a){var b=a&&_.isString(a.state)?a.state:this.defaultState;b&&this.state(b)},states:{},state:function(a){var b,c=_.toArray(arguments);return a?void(a!=this._state&&this.states[a]&&(this._state&&(b=this.states[this._state],_.isFunction(b.exit)&&(b.exit.apply(this,c),this.trigger("state:exit",this._state)),this.$el&&this.$el.removeClass(this._state+"-state")),b=this.states[a],_.isFunction(b.enter)&&(c[0]=this._state,b.enter.apply(this,c),this.trigger("state:enter",a),this.$el&&this.$el.addClass(a+"-state"),this.hasMixin("transitionable")&&this.transitions[a]&&this.transition(this.transitions[a])),this._state=a)):this._state},isState:function(a){return _.isArray(a)?_.contains(a,this._state):this._state==a},hasState:function(a){var b=this.states[a];return!_.isNull(b)&&!_.isUndefined(b)}}),Blaze.Mixer.add("templated",{getTemplate:function(a,b,c){return Blaze.Templates.render(a,b,c)},getRawTemplate:function(a,b,c){return Blaze.Templates.renderRaw(a,b,c)},template:function(a,b,c){var d=this.getTemplate(a,b,c);this.$el.html(d)},templateRaw:function(a,b,c){var d=this.getRawTemplate(a,b,c);this.$el.html(d)},subTemplate:function(a,b,c,d){this.$(a).html(this.getTemplate(b,c,d))},getTemplateIdOr:function(a){var b=[];return this.model&&_.isFunction(this.model.getFormatedNodeId)&&(b.push(this.model.getFormatedNodeId("_")),b.push(this.model.get("sTemplate"))),this.config&&b.push(this.config.sTemplate),this.templateId&&b.push(this.templateId),Blaze.Templates.hasMatch(_.compact(b))||a}}),Blaze.Mixer.add("timeTracker",{args:{visits:"nVisits",timer:"nTime"},mixinBeforeInitialize:function(){this.delegateGlobal({"node:create":"onNodeCreated","node:before:render":"startTimeTracking","node:before:remove":"stopTimeTracking"})},onNodeCreated:function(a){a.set({nVisits:0,nTime:0},{silent:!0})},startTimeTracking:function(a){var b,c=this.getTimeableNodes(a);this._startTime=(new Date).getTime(),b=this.nodes?_.difference(c,this.nodes):c,_.each(b,function(a){a.incCounter(this.args.visits)},this),this.nodes=c},stopTimeTracking:function(){var a=this.getEndTime();_.each(this.nodes,function(b){b.incCounter(this.args.timer,a)},this)},getEndTime:function(){return this.getTimer()-this._startTime},getTimer:function(){return(new Date).getTime()},getTimeableNodes:function(a){var b=a.getParents();return _.isArray(b)?(b.reverse(),b.push(a),b):[a]}}),Blaze.Mixer.add("toggleEnabled",{mixinBeforeInitialize:function(){this._enabled=!0},enable:function(){this._enabled=!0,this.trigger("enabled"),this.$el&&this.$el.removeClass("disabled").addClass("enabled"),this.onEnabled()},disable:function(){this._enabled=!1,this.trigger("disabled"),this.$el&&this.$el.removeClass("enabled").addClass("disabled"),this.onDisabled()},toggleEnabled:function(a){_.isBoolean(a)||(a=!this._enabled),this.setEnabled(a)},onEnabled:function(){},onDisabled:function(){},setEnabled:function(a){a?this.enable():this.disable()},isEnabled:function(){return this._enabled}}),Blaze.Mixer.add("toggleVisible",{mixinBeforeInitialize:function(){this._visible=!0},hide:function(){this._visible=!1,this.useVisibleProp?this.$el.css({visibility:"hidden"}):this.$el.hide(),this.onHide(),this.trigger("hide")},show:function(){this._visible=!0,this.useVisibleProp?this.$el.css({visibility:"visible"}):this.$el.show(),this.onShow(),this.trigger("show")},onShow:function(){},onHide:function(){},toggleVisible:function(){this.setVisible(!this._visible)},setVisible:function(a){a?this.show():this.hide()},isVisible:function(){return this._visible}}),Blaze.Mixer.add("transitionable",{transitions:{},autoTransition:!0,mixinBeforeInitialize:function(){this._transitions=_.extend({},this.transitions)},profileReady:function(){_.extend(this._transitions,_.reduce(this.config,function(a,b,c){if(-1!=c.indexOf("sTransition")){var d=c.slice(c.indexOf("sTransition")+11);"_"==d.charAt(0)&&(d=d.slice(1)),a[d]=b}return a},{}))},configTransitions:function(){var a=this.config;return _.chain(a).filter(function(a,b){return-1!=b.indexOf("sTransition")}).reduce(function(a,b,c){var d=c.slice(c.indexOf("sTransition")+11);return"_"==d.charAt(0)&&(d=d.slice(1)),a[d]=b,a},{}).value()},mixinAfterRender:function(a){var b;this._transitions.intro&&this.autoTransition&&(b=this.transition(this._transitions.intro),a&&a.push(b))},mixinBeforeRemove:function(a){var b;this._transitions.outro&&this.autoTransition&&(b=this.transition(this._transitions.outro),a&&a.push(b))},transition:function(a,b){return _.isString(a)&&this.transitions[a]&&(a=this.transitions[a]),Blaze.Transitions.run(a,this.$el,this,b)},transitionOr:function(a,b,c){var d=this.getTransition(a);return d?this.transition(d,c):Q.fcall(_.bind(b,this),c)},hasTransition:function(a){return this.getTransition(a)},getTransition:function(a){return this._transitions[a]},transitionToState:function(a,b){var c=this,d=this.transition(a);return this.hasMixin("stateful")&&d.then(function(){c.state(b)}),d}})}();